<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQ Ø«Ù‚Ø§ÙØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffd700;
            --blue: #0ea5e9;
            --glass: rgba(255, 255, 255, 0.1);
            --dark-glass: rgba(0, 0, 0, 0.7);
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: 'Cairo', sans-serif; color: white;
            overflow: hidden;
            background: #1a1a1a url('Warface Wallpaper.jpeg') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
        }

        .overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.55); z-index: 1; }

        .top-bar {
            position: fixed; top: 0; width: 100%; padding: 10px 15px;
            display: none; justify-content: space-between; align-items: center; z-index: 1000;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            box-sizing: border-box; border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .icon-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 12px; border-radius: 12px; cursor: pointer; color: white; font-weight: 700;
        }

        .screen {
            position: relative; z-index: 10; height: 100vh;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box;
        }
        .active { display: flex; }

        /* Ù„ØºØ§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .lang-btn {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 15px; border-radius: 15px; cursor: pointer; font-weight: 900;
        }
        .lang-btn.active-lang { background: var(--blue); box-shadow: 0 0 15px var(--blue); }

        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 450px; }
        .cat-btn {
            background: var(--glass); padding: 25px 10px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer; font-weight: 900; color: white; font-size: 1.1rem;
        }

        .map-view { width: 100%; overflow-y: auto; padding: 120px 0; display: flex; flex-direction: column-reverse; align-items: center; gap: 35px; }
        .lvl-node {
            width: 70px; height: 70px; border-radius: 50%; background: rgba(0,0,0,0.7); border: 4px solid #444;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 900; cursor: pointer;
        }
        .unlocked { border-color: var(--blue); background: rgba(14, 165, 233, 0.3); }
        .current { border-color: var(--gold); background: var(--gold); color: black; animation: pulse 2s infinite; }

        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); box-shadow: 0 0 20px var(--gold); } }

        .quiz-container {
            position: fixed; bottom: -100%; left: 0; width: 100%; background: rgba(15,15,15,0.98);
            border-radius: 35px 35px 0 0; padding: 30px 20px; z-index: 2000; transition: 0.6s; max-height: 75vh;
        }
        .quiz-container.show { bottom: 0; }

        .ans-btn { background: rgba(255,255,255,0.07); padding: 18px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; color: white; margin-bottom: 10px; }
        .ans-btn.correct { background: #10b981 !important; }
        .ans-btn.wrong { background: #ef4444 !important; }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¨ØµØ±ÙŠ (Feedback) */
        .feedback-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.5);
            padding: 20px 40px; border-radius: 25px; font-size: 2rem; font-weight: 900;
            z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center;
        }
        .feedback-overlay.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .fb-correct { background: rgba(16, 185, 129, 0.9); border: 2px solid #10b981; }
        .fb-wrong { background: rgba(239, 68, 68, 0.9); border: 2px solid #ef4444; }

        .ad-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); z-index: 3000; }
        .gold-btn { background: var(--gold); border: none; padding: 15px 30px; border-radius: 12px; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

<audio id="bg-audio" src="./jazz-music-466491.mp3" loop></audio>
<audio id="snd-correct" src="https://www.soundjay.com/buttons/sounds/button-37a.mp3"></audio>
<audio id="snd-wrong" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>

<div class="overlay"></div>

<div id="feedback-ui" class="feedback-overlay">
    <div id="fb-icon" style="font-size: 3rem; margin-bottom: 10px;"></div>
    <div id="fb-text"></div>
</div>

<div id="top-bar" class="top-bar">
    <div style="display:flex; gap:15px;">
        <span>ğŸ† <span id="score-val">0</span></span>
        <span style="color:#ff4d4d">â¤ï¸ <span id="hearts-val">8</span></span>
    </div>
    <div style="display:flex; gap:10px;">
        <button onclick="showAdModal()" class="icon-btn" id="txt-recharge">ğŸ“º</button>
        <button id="mute-btn" class="icon-btn">ğŸ”Š</button>
        <button onclick="location.reload()" class="icon-btn">ğŸ </button>
    </div>
</div>

<div id="scr-start" class="screen active">
    <h1 id="main-logo" style="font-size: 3.5rem; color: var(--gold); font-weight: 900;">IQ Ø«Ù‚Ø§ÙØ©</h1>
    <div style="background: var(--glass); padding: 20px; border-radius: 20px; margin: 20px; max-width: 350px;">
        <p id="fact-txt">...</p>
    </div>
    <button id="btn-start" onclick="showCats()" class="gold-btn" style="padding: 20px 80px; font-size: 1.4rem; border-radius: 50px;">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
</div>

<div id="scr-cats" class="screen">
    <h2 id="txt-select-cat" style="margin-bottom: 25px;">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</h2>
    <div style="display:flex; gap:10px; margin-bottom: 25px;">
        <button id="btn-lang-ar" class="lang-btn" onclick="setLanguage('ar')">Ar ğŸ‡¸ğŸ‡¦</button>
        <button id="btn-lang-en" class="lang-btn" onclick="setLanguage('en')">En ğŸ‡ºğŸ‡¸</button>
        <button id="btn-lang-es" class="lang-btn" onclick="setLanguage('es')">Es ğŸ‡ªğŸ‡¸</button>
        <button id="btn-lang-fr" class="lang-btn" onclick="setLanguage('fr')">Fr ğŸ‡«ğŸ‡·</button>
    </div>
    <div class="cat-grid" id="cat-grid-container"></div>
</div>

<div id="scr-map" class="screen" style="padding:0; justify-content: flex-start;">
    <div class="map-view" id="map-cont"></div>
</div>

<div class="quiz-container" id="quiz-ui">
    <div id="q-text" style="font-size: 1.3rem; font-weight: bold; margin-bottom: 20px;"></div>
    <div id="ans-box" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>
    <div style="text-align: center; margin-top: 20px;">
        <button id="remove-two-btn" class="icon-btn" style="background:rgba(255,255,255,0.1); width: 100%;"></button>
    </div>
</div>

<div class="ad-modal" id="ad-modal">
    <div style="background:#222; padding:30px; border-radius:20px; text-align:center; border:2px solid var(--gold); width:80%;">
        <h3 id="txt-no-hearts" style="color:var(--gold)"></h3>
        <p id="txt-ad-desc"></p>
        <div id="ad-timer" style="display:none; font-size: 2rem; color:var(--gold); margin:15px;">5</div>
        <button id="watch-ad-btn" class="gold-btn">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
        <button onclick="closeAdModal()" style="background:none; border:none; color:gray; margin-top:15px; cursor:pointer;" id="txt-later"></button>
    </div>
</div>

<script>
    const CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSJ4RCU1_iXMqLS3ApB1g8SjSrL2hbIAv-1VniqdMElnalov--mSDTpe9rjMxaWGCuP6gpxWV7OZDe1/pub?output=csv";

    const langConfig = {
        ar: { dir:"rtl", logo:"IQ Ø«Ù‚Ø§ÙØ©", start:"Ø§Ø³ØªÙ…Ø±Ø§Ø±", select:"Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ", recharge:"ğŸ“º Ø´Ø­Ù†", noHearts:"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù‚Ù„ÙˆØ¨!", adDesc:"Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚Ù„ÙˆØ¨", later:"Ù„Ø§Ø­Ù‚Ø§Ù‹", removeBtn:"Ø­Ø°Ù Ø®ÙŠØ§Ø±ÙŠÙ† (50)", factLoading:"ØªØ­Ù…ÙŠÙ„...", factsGid:"605574246", ok:"Ø±Ø§Ø¦Ø¹!", no:"Ø®Ø§Ø·Ø¦!", cats:[{name:"â³ Ø§Ù„ØªØ§Ø±ÙŠØ®", gid:"11216236", key:"history"}, {name:"ğŸŒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§", gid:"99625756", key:"geo"}, {name:"ğŸ§¬ Ø§Ù„Ø¹Ù„ÙˆÙ…", gid:"1843208636", key:"science"}, {name:"ğŸ’¡ Ø«Ù‚Ø§ÙØ© Ø¹Ø§Ù…Ø©", gid:"564130158", key:"general"}, {name:"âš½ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©", gid:"0", key:"sports"}] },
        en: { dir:"ltr", logo:"IQ Culture", start:"Continue", select:"Select Category", recharge:"ğŸ“º Refill", noHearts:"No Hearts!", adDesc:"Watch ad for 8 hearts", later:"Later", removeBtn:"Remove 2 (50)", factLoading:"Loading...", factsGid:"259198059", ok:"Great!", no:"Wrong!", cats:[{name:"â³ History", gid:"1950805065", key:"history"}, {name:"ğŸŒ Geography", gid:"1899297807", key:"geo"}, {name:"ğŸ§¬ Science", gid:"407039200", key:"science"}, {name:"ğŸ’¡ General", gid:"1044248022", key:"general"}, {name:"âš½ Sports", gid:"1559005659", key:"sports"}] },
        es: { dir:"ltr", logo:"IQ Cultura", start:"Continuar", select:"Seleccionar", recharge:"ğŸ“º Recargar", noHearts:"Â¡Sin vidas!", adDesc:"Mira un anuncio", later:"Luego", removeBtn:"Eliminar 2 (50)", factLoading:"Cargando...", factsGid:"1911794502", ok:"Â¡Bien!", no:"Â¡Mal!", cats:[{name:"â³ Historia", gid:"948777647", key:"history"}, {name:"ğŸŒ GeografÃ­a", gid:"1233201488", key:"geo"}, {name:"ğŸ§¬ Ciencia", gid:"2028449800", key:"science"}, {name:"ğŸ’¡ Cultura", gid:"1662832315", key:"general"}, {name:"âš½ Deportes", gid:"1795176380", key:"sports"}] },
        fr: { dir:"ltr", logo:"QI Culture", start:"Continuer", select:"CatÃ©gorie", recharge:"ğŸ“º Recharge", noHearts:"Plus de cÅ“urs!", adDesc:"Regarder une vidÃ©o", later:"Plus tard", removeBtn:"Supprimer 2 (50)", factLoading:"Chargement...", factsGid:"1356278776", ok:"Bravo!", no:"Faux!", cats:[{name:"â³ Histoire", gid:"1692460075", key:"history"}, {name:"ğŸŒ GÃ©ographie", gid:"1888258036", key:"geo"}, {name:"ğŸ§¬ Sciences", gid:"1043839601", key:"science"}, {name:"ğŸ’¡ Culture", gid:"1000789609", key:"general"}, {name:"âš½ Sports", gid:"942675202", key:"sports"}] }
    };

    let gameState = { score: parseInt(localStorage.getItem('iq_score')) || 0, progress: JSON.parse(localStorage.getItem('iq_prog')) || {}, hearts: 8, muted: false, lang: 'ar' };

    function init() {
        applyLanguage(); updateUI();
        document.getElementById('mute-btn').onclick = () => { gameState.muted = !gameState.muted; gameState.muted?document.getElementById('bg-audio').pause():document.getElementById('bg-audio').play(); updateUI(); };
        document.getElementById('watch-ad-btn').onclick = startAd;
        document.getElementById('remove-two-btn').onclick = useRemoveTwo;
    }

    function setLanguage(l) { gameState.lang = l; applyLanguage(); }

    function applyLanguage() {
        const c = langConfig[gameState.lang];
        document.documentElement.dir = c.dir;
        document.getElementById('main-logo').innerText = c.logo;
        document.getElementById('btn-start').innerText = c.start;
        document.getElementById('txt-select-cat').innerText = c.select;
        document.getElementById('remove-two-btn').innerText = c.removeBtn;
        document.getElementById('txt-no-hearts').innerText = c.noHearts;
        document.getElementById('txt-ad-desc').innerText = c.adDesc;
        document.getElementById('txt-later').innerText = c.later;
        loadFact(); renderCats();
    }

    function loadFact() {
        fetch(CSV + "&gid=" + langConfig[gameState.lang].factsGid).then(r => r.text()).then(d => {
            const l = d.split(/\r?\n/).slice(1);
            if(l.length) document.getElementById('fact-txt').innerText = l[Math.floor(Math.random()*l.length)].split(',')[0].replace(/"/g, '');
        });
    }

    function renderCats() {
        const cont = document.getElementById('cat-grid-container'); cont.innerHTML = '';
        langConfig[gameState.lang].cats.forEach(c => {
            const b = document.createElement('div'); b.className = 'cat-btn'; b.innerText = c.name;
            if(c.key==='sports') b.style.gridColumn = 'span 2';
            b.onclick = () => startCat(c.gid, c.key); cont.appendChild(b);
        });
    }

    async function startCat(gid, key) {
        gameState.currentCat = key; switchScreen('scr-map');
        const r = await fetch(CSV + "&gid=" + gid); const d = await r.text();
        gameState.questions = d.split(/\r?\n/).slice(1).map(row => {
            const c = row.split(',').map(x => x.trim().replace(/"/g, ''));
            return { q: c[0], opts: [c[1], c[2], c[3], c[4]], a: c[5] };
        }).filter(q => q.q); renderMap();
    }

    function renderMap() {
        const cont = document.getElementById('map-cont'); cont.innerHTML = '';
        const unlocked = gameState.progress[`${gameState.lang}_${gameState.currentCat}`] || 1;
        gameState.questions.forEach((_, i) => {
            const n = document.createElement('div'); n.className = `lvl-node ${i+1 <= unlocked ? 'unlocked' : ''} ${i+1 === unlocked ? 'current' : ''}`;
            n.innerText = i + 1; if(i+1 <= unlocked) n.onclick = () => openQuiz(i); cont.appendChild(n);
        });
    }

    function openQuiz(idx) {
        if(gameState.hearts <= 0) { showAdModal(); return; }
        gameState.activeIdx = idx; const q = gameState.questions[idx];
        document.getElementById('q-text').innerText = q.q;
        const box = document.getElementById('ans-box'); box.innerHTML = '';
        q.opts.forEach(o => {
            const b = document.createElement('div'); b.className = 'ans-btn'; b.innerText = o;
            b.onclick = () => checkAns(b, o, q.a); box.appendChild(b);
        });
        document.getElementById('quiz-ui').classList.add('show');
    }

    function checkAns(btn, sel, cor) {
        const fb = document.getElementById('feedback-ui');
        const c = langConfig[gameState.lang];
        if(sel === cor) {
            if(!gameState.muted) document.getElementById('snd-correct').play();
            fb.className = 'feedback-overlay show fb-correct';
            document.getElementById('fb-icon').innerText = 'âœ”ï¸';
            document.getElementById('fb-text').innerText = c.ok;
            btn.classList.add('correct'); gameState.score += 10;
            const key = `${gameState.lang}_${gameState.currentCat}`;
            if(gameState.activeIdx+1 === (gameState.progress[key]||1)) gameState.progress[key] = (gameState.progress[key]||1)+1;
            save(); updateUI();
            setTimeout(() => { fb.classList.remove('show'); document.getElementById('quiz-ui').classList.remove('show'); renderMap(); }, 1200);
        } else {
            if(!gameState.muted) document.getElementById('snd-wrong').play();
            fb.className = 'feedback-overlay show fb-wrong';
            document.getElementById('fb-icon').innerText = 'âŒ';
            document.getElementById('fb-text').innerText = c.no;
            btn.classList.add('wrong'); gameState.hearts--; save(); updateUI();
            setTimeout(() => fb.classList.remove('show'), 1000);
            if(gameState.hearts <= 0) setTimeout(() => { document.getElementById('quiz-ui').classList.remove('show'); showAdModal(); }, 1200);
        }
    }

    function useRemoveTwo() {
        if(gameState.score < 50) return;
        const q = gameState.questions[gameState.activeIdx];
        const btns = Array.from(document.querySelectorAll('.ans-btn')).filter(b => b.innerText !== q.a);
        for(let i=0; i<2; i++) {
            const r = Math.floor(Math.random()*btns.length);
            btns[r].style.visibility = 'hidden'; btns.splice(r,1);
        }
        gameState.score -= 50; save(); updateUI();
    }

    function startAd() {
        let s = 5; const b = document.getElementById('watch-ad-btn'); const t = document.getElementById('ad-timer');
        b.style.display = 'none'; t.style.display = 'block';
        const i = setInterval(() => { t.innerText = s; s--; if(s < 0) { clearInterval(i); gameState.hearts = 8; save(); updateUI(); closeAdModal(); b.style.display = 'block'; t.style.display = 'none'; }}, 1000);
    }

    function save() { localStorage.setItem('iq_score', gameState.score); localStorage.setItem('iq_prog', JSON.stringify(gameState.progress)); }
    function updateUI() { document.getElementById('score-val').innerText = gameState.score; document.getElementById('hearts-val').innerText = gameState.hearts; document.getElementById('mute-btn').innerText = gameState.muted ? 'ğŸ”‡' : 'ğŸ”Š'; }
    function showCats() { document.getElementById('top-bar').style.display = 'flex'; if(!gameState.muted) document.getElementById('bg-audio').play().catch(()=>{}); switchScreen('scr-cats'); }
    function switchScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function showAdModal() { document.getElementById('ad-modal').style.display = 'flex'; }
    function closeAdModal() { document.getElementById('ad-modal').style.display = 'none'; }

    window.onload = init;
</script>
</body>
</html>
