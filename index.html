<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IQ Quiz Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root {
    --gold:#ffbd39;
    --blue:#0ea5e9;
    --glass:rgba(15,23,42,.85);
}

html,body{
    margin:0;
    height:100%;
    font-family:'Cairo',sans-serif;
    color:#fff;
    background:url('Warface Wallpaper.jpeg') center/cover fixed no-repeat;
    overflow:hidden;
}

.overlay{
    position:fixed;inset:0;
    background:rgba(0,0,0,.5);
    z-index:-1;
}

.top-bar{
    position:fixed;top:0;width:100%;
    display:none;justify-content:space-around;
    padding:15px;
    background:rgba(0,0,0,.6);
    backdrop-filter:blur(10px);
    z-index:1000;
}

.screen{
    display:none;
    height:100vh;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    text-align:center;
    padding:20px;
}
.active{display:flex}

.cat-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
    max-width:450px;
    width:100%;
}

.cat-btn{
    background:var(--glass);
    padding:25px;
    border-radius:20px;
    cursor:pointer;
    font-weight:900;
}
.cat-btn:hover{background:var(--blue)}

.map-view{
    padding:100px 0;
    display:flex;
    flex-direction:column-reverse;
    gap:30px;
}

.lvl-node{
    width:70px;height:70px;
    border-radius:50%;
    background:#0008;
    border:4px solid #444;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    cursor:pointer;
}

.unlocked{border-color:var(--blue)}
.current{
    border-color:var(--gold);
    background:var(--gold);
    color:#000;
    animation:pulse 2s infinite;
}

@keyframes pulse{
    50%{transform:scale(1.1);box-shadow:0 0 20px var(--gold)}
}

.quiz-container{
    position:fixed;
    bottom:-100%;
    width:100%;
    background:var(--glass);
    backdrop-filter:blur(25px);
    border-radius:35px 35px 0 0;
    padding:35px 20px;
    transition:.6s;
    z-index:2000;
}
.quiz-container.show{bottom:0}

.ans-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
}

.ans-btn{
    background:#ffffff10;
    padding:18px;
    border-radius:15px;
    cursor:pointer;
    font-weight:bold;
}
.correct{background:#10b981!important}

#fifty-btn{
    margin:10px auto 15px;
    padding:10px 30px;
    border:none;
    border-radius:25px;
    background:var(--gold);
    font-weight:900;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="overlay"></div>

<div id="top-bar" class="top-bar">
    <span>ğŸ† <span id="score-val">0</span></span>
    <span onclick="location.reload()">ğŸ </span>
</div>

<div id="scr-start" class="screen active">
    <h1 style="font-size:4rem;color:var(--gold)">IQ Ø«Ù‚Ø§ÙØ©</h1>
    <div style="background:var(--glass);padding:20px;border-radius:20px;max-width:350px">
        <p id="fact-txt">ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø©...</p>
    </div>
    <button onclick="showCats()" style="margin-top:20px;padding:15px 70px;border-radius:50px;border:none;background:var(--gold);font-weight:900">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
</div>

<div id="scr-cats" class="screen">
    <h2>Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</h2>
    <div class="cat-grid">
        <div class="cat-btn" onclick="startCat('11216236','history')">â³ Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
        <div class="cat-btn" onclick="startCat('99625756','geo')">ğŸŒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</div>
        <div class="cat-btn" onclick="startCat('1843208636','science')">ğŸ§¬ Ø§Ù„Ø¹Ù„ÙˆÙ…</div>
        <div class="cat-btn" onclick="startCat('564130158','general')">ğŸ’¡ Ø«Ù‚Ø§ÙØ© Ø¹Ø§Ù…Ø©</div>
        <div class="cat-btn" style="grid-column:span 2" onclick="startCat('0','sports')">âš½ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©</div>
    </div>
</div>

<div id="scr-map" class="screen">
    <div class="map-view" id="map-cont"></div>
</div>

<div class="quiz-container" id="quiz-ui">
    <div id="q-text" style="font-size:1.3rem;font-weight:bold"></div>

    <!-- Ø²Ø± Ø­Ø°Ù Ø¥Ø¬Ø§Ø¨ØªÙŠÙ† -->
    <button id="fifty-btn" onclick="useFifty()">âŒ Ø­Ø°Ù Ø¥Ø¬Ø§Ø¨ØªÙŠÙ† (50 Ù†Ù‚Ø·Ø©)</button>

    <div class="ans-grid" id="ans-box"></div>
</div>

<script>
const CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJ4RCU1_iXMqLS3ApB1g8SjSrL2hbIAv-1VniqdMElnalov--mSDTpe9rjMxaWGCuP6gpxWV7OZDe1/pub?output=csv";

let gameState={
    score:+localStorage.getItem("iq_total_score")||0,
    progress:JSON.parse(localStorage.getItem("iq_cat_progress"))||{history:1,geo:1,science:1,general:1,sports:1},
    currentCat:"",
    questions:[],
    activeIdx:0
};

async function init(){
    const r=await fetch(CSV+"&gid=605574246");
    const d=await r.text();
    const lines=d.split("\n").slice(1);
    factTxt.innerText=lines[Math.random()*lines.length|0].split(",")[0];
}

function showCats(){
    topBar.style.display="flex";
    scoreVal.innerText=gameState.score;
    switchScreen("scr-cats");
}

async function startCat(gid,cat){
    gameState.currentCat=cat;
    switchScreen("scr-map");
    const r=await fetch(CSV+"&gid="+gid);
    const d=await r.text();
    gameState.questions=d.split("\n").slice(1).map(r=>{
        const c=r.split(",").map(x=>x.replace(/"/g,""));
        return{q:c[0],opts:[c[1],c[2],c[3],c[4]],a:c[5]};
    }).filter(q=>q.q);
    renderMap();
}

function renderMap(){
    mapCont.innerHTML="";
    const u=gameState.progress[gameState.currentCat];
    gameState.questions.forEach((_,i)=>{
        const n=document.createElement("div");
        n.className=`lvl-node ${i+1<=u?"unlocked":""} ${i+1===u?"current":""}`;
        n.innerText=i+1;
        if(i+1<=u) n.onclick=()=>openQuiz(i);
        mapCont.appendChild(n);
    });
}

function openQuiz(i){
    gameState.activeIdx=i;
    fiftyBtn.disabled=false;
    fiftyBtn.style.opacity=1;

    const q=gameState.questions[i];
    qText.innerText=q.q;
    ansBox.innerHTML="";
    q.opts.forEach(o=>{
        const b=document.createElement("div");
        b.className="ans-btn";
        b.innerText=o;
        b.onclick=()=>{
            if(o===q.a){
                b.classList.add("correct");
                gameState.score+=10;
                if(i+1===gameState.progress[gameState.currentCat]) gameState.progress[gameState.currentCat]++;
                save();
                setTimeout(()=>{quizUi.classList.remove("show");renderMap()},600);
            }else b.style.background="#ef4444";
        };
        ansBox.appendChild(b);
    });
    quizUi.classList.add("show");
}

function useFifty(){
    if(gameState.score<50) return alert("âŒ Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ©");
    const q=gameState.questions[gameState.activeIdx];
    const wrong=[...document.querySelectorAll(".ans-btn")].filter(b=>b.innerText!==q.a);
    wrong.sort(()=>0.5-Math.random()).slice(0,2).forEach(b=>b.style.visibility="hidden");
    gameState.score-=50;
    save();
    fiftyBtn.disabled=true;
    fiftyBtn.style.opacity=.5;
}

function save(){
    localStorage.setItem("iq_total_score",gameState.score);
    localStorage.setItem("iq_cat_progress",JSON.stringify(gameState.progress));
    scoreVal.innerText=gameState.score;
}

function switchScreen(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

init();
</script>

</body>
</html>
